<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="style.css">
        <title>Clicker</title>
    </head>
    <body>

        <header>
            <div class="statsContainer">
                <h1 id="moneyTxt">$ 0</h1>
                <p id="mpsTxt">0 MPS</p>
                <button onclick="saveData()">Save</button>
                <button onclick="loadData()">Load</button>
            </div>
        </header>


        <div class="container">
            <div class="special_buttons">
                <ul>
                    <li>
                        <button id="rebirthButton" onclick=rebirth(15000)>
                            <span id="rebirthTxt">Rebirth: 2x money income</span>
                            <span id="rebirthValue"><br>$ 15.000</span>
                        </button>
                    </li>
                </ul>
            </div>
            <img src="click_button.png" id="clickButton">
            <div class="upgrade_buttons">
                <ul>
                    <li>
                        <button id="upgrade0" onclick=increaseClick(1,100,0)>
                            <span>Upgrade: +1 Click Value</span>
                            <span id="upgrade0value"><br>$ 100</span>
                        </button>
                    </li>
                    <li>
                         <button id="upgrade1" onclick=increaseClick(5,300,1)>
                            <span>Upgrade: +5 Click Value</span>
                            <span id="upgrade1value"><br>$ 300</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>


        <script type="text/javascript" defer>
            const clickButton = document.getElementById("clickButton");
            const moneyTxt = document.getElementById("moneyTxt");
            const mpsTxt = document.getElementById("mpsTxt");

            let money = 0;
            let mps = 0;
            let clickValue = 1;
            let rebirths = 1;
            let upgradeAmount = Array(document.getElementsByClassName("upgrade_buttons").length+1).fill("0",0,3);

            clickButton.addEventListener("click", () =>{
                money += clickValue*rebirths;
                moneyTxt.innerHTML = "$ " + money;
            })

            function increaseClick(value, price, upgradeId){
                if(upgradeAmount[upgradeId]>0) {
                    price = Math.round(price*(1.15**upgradeAmount[upgradeId]))
                }
                if(money >= price){
                    clickValue += value;
                    money -= price;
                    moneyTxt.innerHTML = "$ " + money;
                    upgradeAmount[upgradeId]++;
                    price = Math.round(price*(1.15**upgradeAmount[upgradeId]))
                    console.log(upgradeAmount[upgradeId])
                    console.warn(Math.round(price*(1.15**upgradeAmount[upgradeId])))
                    document.getElementById("upgrade"+upgradeId+"value").innerHTML = "<br>$ "+price;
                }
                return;
            }

            function rebirth(value) {
                if(money >= value){
                    money = 0;
                    clickValue = 1;
                    rebirths++;
                    let newValue = Math.round(value*1.25);
                    document.getElementById("rebirthValue").innerHTML = "<br>$ "+newValue;
                    document.getElementById("rebirthTxt").innerHTML = "Rebirth: " + (rebirths+1) + "x money income";
                    document.getElementById("rebirthButton").onclick = function onclick(event){rebirth(newValue)};
                    upgradeAmount = Array(document.getElementsByClassName("upgrade_buttons").length+1).fill("0",0,3);
                    moneyTxt.innerHTML = "$ " + money;
                    mpsTxt.innerHTML = mps + " MPS";
                }
                return;
            }

            function updateMoneyWithMPS() {
                if(mps){
                    money += mps*rebirths;
                    moneyTxt.innerHTML = "$ " + money;
                }
            }

            function saveData() {
                if(money) {
                    localStorage.setItem("money", money)
                }
                if(mps) {
                    localStorage.setItem("mps", mps)
                }
                if(rebirths) {
                    localStorage.setItem("rebirths", rebirths)
                }
                if(clickValue) {
                    localStorage.setItem("clickValue", clickValue)
                }
            }

            function loadData() {
                if(localStorage.getItem("money")) {
                    money = parseInt(localStorage.getItem("money"));
                    moneyTxt.innerHTML = "$ " + money;
                }
                if(localStorage.getItem("mps")) {
                    mps = parseInt(localStorage.getItem("mps"));
                    mpsTxt.innerHTML = mps + " MPS";
                }
                if(localStorage.getItem("rebirths")) {
                    rebirths = parseInt(localStorage.getItem("rebirths"));
                }
                if(localStorage.getItem("clickValue")) {
                    clickValue = parseInt(localStorage.getItem("clickValue"));
                }
            }

            function updateButtonValues();

            setInterval(updateMoneyWithMPS, 1000)
        </script>
    </body>
</html>